pipeline {
  
  parameters {
    string(name: 'environment', defaultValue: 'default', description: 'Workspace/environment file to use for deployment')
    booleanParam(name : 'autoApprove', defaultValue: false, description: 'Automatically run apply after generating plan?')
  }
  
  environment{
    aws_access_key = credentials('aws_access_key')
    aws_secret_key = credentials('aws_secret_key')
    
  }

  agent { label 'linux'}

  tools {
     terraform 'terraform-10'
  }
 
  options {
    skipDefaultCheckout(true)
  }
  stages{
    stage('clean workspace') {
      steps {
        cleanWs()
      }
    }
    
   
    
 stage('checkoutsg') {
 
 steps{
    
     sh  'git clone https://7c9b2053-671e-471e-9f8a-e3aa64c00a58@github.com/Shantanusri123/security_groups.git' 
     
     
  } 

}

 stage('checkoutsgtfvars') {
  steps{
  
       sh  'git clone https://7c9b2053-671e-471e-9f8a-e3aa64c00a58@github.com/Shantanusri123/security_groups_tfvars.git'
    
    }
    
 }
    stage('terraform init') {
      steps {
        
        sh 'terraform  -chdir="/var/jenkins_home/workspace/jenkins-test/security_groups" init'
        
        sh 'terraform -version'
      }
    }
    
     stage('terraform plan') {
      steps {
        sh 'terraform plan -var-file="/var/jenkins_home/workspace/jenkins-test/security_groups_tfvars/${environment}.tfvars"'
      }
    }

    
  }
   
 
}
